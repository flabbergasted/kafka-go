<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
<script type="text/javascript">
    "use strict";
    var moving = new Direction();
    var vel = new Vector();
    var speedConstant = 2;
    var conn;
    document.addEventListener('keyup', (event) => {
        const keyName = event.key;
        if (event.keyCode == 38) {
            moving.North = false;
            vel.Y = 0;
        }
        if (event.keyCode == 40) {
            moving.South = false;
            vel.Y = 0;
        }
        if (event.keyCode == 39) {
            moving.East = false;
            vel.X = 0;
        }
        if (event.keyCode == 37) {
            moving.West = false;
            vel.X = 0;
        }
    });
    document.addEventListener('keydown', (event) => {
        const keyName = event.key;
        var player = document.getElementById("player1");

        if (event.keyCode == 38 && !moving.North) {
            moving.North = true;
            vel.Y = -1 * speedConstant;
        }
        if (event.keyCode == 40 && !moving.South) {
            moving.South = true;
            vel.Y = speedConstant;
        }
        if (event.keyCode == 39 && !moving.East) {
            moving.East = true;
            vel.X = speedConstant;
        }
        if (event.keyCode == 37 && !moving.West) {
            moving.West = true;
            vel.X = -1 * speedConstant;
        }
    });
    $(document).ready(function () {
        open();
        conn.send("Test");
        window.requestAnimationFrame(MovePlayer);
    });
    function Vector() {
        this.X = 0;
        this.Y = 0;
    }
    function Direction() {
        var self = this;

        this.North = false;
        this.South = false;
        this.East = false;
        this.West = false;
        this.IsMoving = function () {
            return self.North || self.South || self.East || self.West;
        }
    }
    function ParsePxToNumber(pixels) {
        var ipx = pixels.replace("px", "") * -1 * -1;

        return ipx;
    }
    function MovePlayer() {
        var player = document.getElementById("player1");
        if (moving.IsMoving()) {
            applyVelocityToPlayer(player, vel);
        }
        window.requestAnimationFrame(MovePlayer);
    }
    function applyVelocityToPlayer(player, vel){
        var top = ParsePxToNumber(player.style.top) + vel.Y,
            left = ParsePxToNumber(player.style.left) + vel.X;
        
        if(top < 0){
            top = 0;
        }
        if(left < 0){
            left = 0;
        }
        if(top + ParsePxToNumber(player.style.height) > 500){
            top = 500 - player.style.height;
        }
        if(left + ParsePxToNumber(player.style.width) > 500){
            left = 500 - player.style.width;
        }
        
        player.style.top = top;
        player.style.left = left;
    }
    function open(){
        if (window["WebSocket"]) {
            conn = new WebSocket("ws://" + document.location.host + "/ws");
            conn.onclose = function (evt) {
                var item = document.createElement("div");
                item.innerHTML = "<b>Connection closed.</b>";
                appendLog(item);
            };
            conn.onmessage = function (evt) {
                var messages = evt.data.split('\n');
                for (var i = 0; i < messages.length; i++) {
                    var item = document.createElement("div");
                    item.innerText = messages[i];
                    appendLog(item);
                }
            };
        } else {
            var item = document.createElement("div");
            item.innerHTML = "<b>Your browser does not support WebSockets.</b>";
            appendLog(item);
        }
    }
</script>
<h2>Home</h2>
<div style="height:500px; width:500px; background-color:black">
    <div class="player" id="player1" style="position:relative; height:10px; width:10px; background-color:yellow;"></div>
</div>